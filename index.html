<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Elephant Detector Debug</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 20px; }
    #canvas { border: 2px solid black; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Elephant Detector Debug</h2>
  <input type="file" id="imageUpload" accept="image/*">
  <br>
  <canvas id="canvas"></canvas>

  <script>
    let model;

    async function loadModel() {
      console.log("⏳ Loading model...");
      model = await tf.loadGraphModel("https://emaapp.github.io/elephant/tfjs_model/model.json");
      console.log("✅ Model loaded:", model.outputNodes);
    }

    async function detect(imgElement) {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      canvas.width = imgElement.width;
      canvas.height = imgElement.height;
      ctx.drawImage(imgElement, 0, 0);

      const input = tf.tidy(() =>
        tf.browser.fromPixels(imgElement)
          .resizeBilinear([640, 640])
          .div(255.0)
          .expandDims(0)
      );

      const output = await model.executeAsync(input);

      console.log("🔍 Output type:", Array.isArray(output), output);

      if (Array.isArray(output)) {
        output.forEach((t, i) => console.log("Tensor", i, t.shape));
        const arr = await output[0].array();
        console.log("First 5 rows:", arr[0].slice(0, 5));
      } else {
        console.log("Tensor shape:", output.shape);
        const arr = await output.array();
        console.log("First 5 rows:", arr[0].slice(0, 5));
      }

      input.dispose();
    }

    document.getElementById("imageUpload").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const img = new Image();
      img.onload = () => detect(img);
      img.src = URL.createObjectURL(file);
    });

    loadModel();
  </script>
</body>
</html>
