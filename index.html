<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Elephant Detector</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f4f4f4; }
    canvas { border: 2px solid #333; margin-top: 10px; }
    #status { margin: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Elephant Detector üêò</h1>
  <input type="file" id="fileInput" accept="image/*">
  <div id="status">Loading model...</div>
  <canvas id="canvas"></canvas>
  <script>
    let model;
    const status = document.getElementById("status");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    async function loadModel() {
      model = await tf.loadGraphModel("https://emaapp.github.io/elephant/tfjs_model/model.json");
      status.textContent = "‚úÖ Model loaded. Upload an image.";
    }

    async function predict(img) {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0, img.width, img.height);

      let tensor = tf.browser.fromPixels(img).toFloat();
      tensor = tf.image.resizeBilinear(tensor, [640, 640]).expandDims(0);

      const outputs = await model.executeAsync(tensor);

      const boxes = outputs[0].arraySync()[0];
      const scores = outputs[1].arraySync()[0];
      const classes = outputs[2].arraySync()[0];

      let elephantCount = 0;

      for (let i = 0; i < scores.length; i++) {
        if (scores[i] > 0.5) {
          const [ymin, xmin, ymax, xmax] = boxes[i];
          const x = xmin * img.width;
          const y = ymin * img.height;
          const w = (xmax - xmin) * img.width;
          const h = (ymax - ymin) * img.height;

          ctx.strokeStyle = "red";
          ctx.lineWidth = 3;
          ctx.strokeRect(x, y, w, h);

          ctx.fillStyle = "red";
          ctx.font = "18px Arial";
          const label = "Elephant " + (scores[i]*100).toFixed(1) + "%";
          ctx.fillText(label, x, y > 20 ? y - 5 : y + 20);

          elephantCount++;
          console.log("üêò Elephant at:", {x,y,w,h,score:scores[i]});
        }
      }
      console.log("‚úÖ Total elephants detected:", elephantCount);
      status.textContent = "Detected " + elephantCount + " elephants.";
      tf.dispose(outputs);
    }

    document.getElementById("fileInput").addEventListener("change", e => {
      const file = e.target.files[0];
      if (!file) return;
      const img = new Image();
      img.onload = () => predict(img);
      img.src = URL.createObjectURL(file);
    });

    loadModel();
  </script>
</body>
</html>
